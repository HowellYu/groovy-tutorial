<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>35. Blocks</title>
<link href="stylesheet.css" type="text/css" rel="stylesheet" />
</head>
<body>
<div id="leanpub-toc">
<h2></h2>
<ol class="toc has-parts">
<ul class='toc has-parts'>
  <li>
    <ul>
      <li>
        <a href='chap00.html#leanpub-auto-introduction'>Introduction</a>
      </li>
      <li>
        <a href='chap01.html#leanpub-auto-legal-notices'>Legal Notices</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap02.html#leanpub-auto-getting-started'><span class="section-number">I </span>Getting started</a>
    <ul>
      <li>
        <a href='chap03.html#leanpub-auto-installing-groovy'><span class="section-number">1. </span>Installing Groovy</a>
      </li>
      <li>
        <a href='chap04.html#leanpub-auto-your-first-lines-of-groovy'><span class="section-number">2. </span>Your first lines of Groovy</a>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-comments'><span class="section-number">3. </span>Comments</a>
      </li>
      <li>
        <a href='chap06.html#leanpub-auto-statements'><span class="section-number">4. </span>Statements</a>
      </li>
      <li>
        <a href='chap07.html#leanpub-auto-the-assert-statement'><span class="section-number">5. </span>The <code>assert</code> statement</a>
      </li>
      <li>
        <a href='chap08.html#leanpub-auto-reserved-words'><span class="section-number">6. </span>Reserved Words</a>
      </li>
      <li>
        <a href='chap09.html#leanpub-auto-packages'><span class="section-number">7. </span>Packages</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap10.html#leanpub-auto-variables'><span class="section-number">II </span>Variables</a>
    <ul>
      <li>
        <a href='chap11.html#leanpub-auto-declaring-variables'><span class="section-number">8. </span>Declaring Variables</a>
      </li>
      <li>
        <a href='chap12.html#leanpub-auto-data-types'><span class="section-number">9. </span>Data Types</a>
      </li>
      <li>
        <a href='chap13.html#leanpub-auto-objects'><span class="section-number">10. </span>Objects</a>
      </li>
      <li>
        <a href='chap14.html#leanpub-auto-booleans'><span class="section-number">11. </span>Booleans</a>
      </li>
      <li>
        <a href='chap15.html#leanpub-auto-numbers'><span class="section-number">12. </span>Numbers</a>
      </li>
      <li>
        <a href='chap16.html#leanpub-auto-strings'><span class="section-number">13. </span>Strings</a>
      </li>
      <li>
        <a href='chap17.html#leanpub-auto-collections'><span class="section-number">14. </span>Collections</a>
      </li>
      <li>
        <a href='chap18.html#leanpub-auto-arrays'><span class="section-number">15. </span>Arrays</a>
      </li>
      <li>
        <a href='chap19.html#leanpub-auto-ranges'><span class="section-number">16. </span>Ranges</a>
      </li>
      <li>
        <a href='chap20.html#leanpub-auto-regular-expressions'><span class="section-number">17. </span>Regular Expressions</a>
      </li>
      <li>
        <a href='chap21.html#leanpub-auto-data-types-1'><span class="section-number">18. </span>Data types</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap22.html#leanpub-auto-operators'><span class="section-number">III </span>Operators</a>
    <ul>
      <li>
        <a href='chap23.html#leanpub-auto-operators-1'><span class="section-number">19. </span>Operators</a>
      </li>
      <li>
        <a href='chap24.html#leanpub-auto-numeric-operators'><span class="section-number">20. </span>Numeric Operators</a>
      </li>
      <li>
        <a href='chap25.html#leanpub-auto-simple-assignment-operator'><span class="section-number">21. </span>Simple Assignment Operator</a>
      </li>
      <li>
        <a href='chap26.html#leanpub-auto-the-complement-operator'><span class="section-number">22. </span>The Complement Operator</a>
      </li>
      <li>
        <a href='chap27.html#leanpub-auto-equality-operators'><span class="section-number">23. </span>Equality Operators</a>
      </li>
      <li>
        <a href='chap28.html#leanpub-auto-arithmetic-operators'><span class="section-number">24. </span>Arithmetic operators</a>
      </li>
      <li>
        <a href='chap29.html#leanpub-auto-relational-operators'><span class="section-number">25. </span>Relational Operators</a>
      </li>
      <li>
        <a href='chap30.html#leanpub-auto-increment-and-decrement-operators'><span class="section-number">26. </span>Increment and Decrement Operators</a>
      </li>
      <li>
        <a href='chap31.html#leanpub-auto-conditional-operators'><span class="section-number">27. </span>Conditional Operators</a>
      </li>
      <li>
        <a href='chap32.html#leanpub-auto-bitwise-operators'><span class="section-number">28. </span>Bitwise Operators</a>
      </li>
      <li>
        <a href='chap33.html#leanpub-auto-compound-assignment-operators'><span class="section-number">29. </span>Compound Assignment Operators</a>
      </li>
      <li>
        <a href='chap34.html#leanpub-auto-string-operators-1'><span class="section-number">30. </span>String Operators</a>
      </li>
      <li>
        <a href='chap35.html#leanpub-auto-regular-expression-operators-1'><span class="section-number">31. </span>Regular Expression Operators</a>
      </li>
      <li>
        <a href='chap36.html#leanpub-auto-collection-operators-1'><span class="section-number">32. </span>Collection operators</a>
      </li>
      <li>
        <a href='chap37.html#leanpub-auto-object-operators-1'><span class="section-number">33. </span>Object Operators</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap38.html#leanpub-auto-control-flow-statements'><span class="section-number">IV </span>Control Flow Statements</a>
    <ul>
      <li>
        <a href='chap39.html#leanpub-auto-introduction-1'><span class="section-number">34. </span>Introduction</a>
      </li>
      <li>
        <a href='chap40.html#leanpub-auto-blocks'><span class="section-number">35. </span>Blocks</a>
      </li>
      <li>
        <a href='chap41.html#leanpub-auto-the-if-statement'><span class="section-number">36. </span>The <code>if</code> Statement</a>
      </li>
      <li>
        <a href='chap42.html#leanpub-auto-the-switch-statement'><span class="section-number">37. </span>The <code>switch</code> Statement</a>
      </li>
      <li>
        <a href='chap43.html#leanpub-auto-the-for-loop'><span class="section-number">38. </span>The <code>for</code> Loop</a>
      </li>
      <li>
        <a href='chap44.html#leanpub-auto-the-while-loop'><span class="section-number">39. </span>The <code>while</code> loop</a>
      </li>
      <li>
        <a href='chap45.html#leanpub-auto-branching-statements'><span class="section-number">40. </span>Branching statements</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap46.html#leanpub-auto-exceptions'><span class="section-number">V </span>Exceptions</a>
    <ul>
      <li>
        <a href='chap47.html#leanpub-auto-the-throwable-family'><span class="section-number">41. </span>The Throwable Family</a>
      </li>
      <li>
        <a href='chap48.html#leanpub-auto-common-exceptions'><span class="section-number">42. </span>Common Exceptions</a>
      </li>
      <li>
        <a href='chap49.html#leanpub-auto-anatomy-of-an-exception'><span class="section-number">43. </span>Anatomy of an Exception</a>
      </li>
      <li>
        <a href='chap50.html#leanpub-auto-try-catch-finally'><span class="section-number">44. </span>Try-Catch-Finally</a>
      </li>
      <li>
        <a href='chap51.html#leanpub-auto-how-much-should-we-try'><span class="section-number">45. </span>How Much Should We try?</a>
      </li>
      <li>
        <a href='chap52.html#leanpub-auto-causing-an-exception'><span class="section-number">46. </span>Causing an Exception</a>
      </li>
      <li>
        <a href='chap53.html#leanpub-auto-catching-errors'><span class="section-number">47. </span>Catching Errors</a>
      </li>
      <li>
        <a href='chap54.html#leanpub-auto-methods-and-exceptions'><span class="section-number">48. </span>Methods and Exceptions</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap55.html#leanpub-auto-methods'><span class="section-number">VI </span>Methods</a>
    <ul>
      <li>
        <a href='chap56.html#leanpub-auto-the-basics'><span class="section-number">49. </span>The Basics</a>
      </li>
      <li>
        <a href='chap57.html#leanpub-auto-parameters'><span class="section-number">50. </span>Parameters</a>
      </li>
      <li>
        <a href='chap58.html#leanpub-auto-default-values-for-parameters'><span class="section-number">51. </span>Default Values for Parameters</a>
      </li>
      <li>
        <a href='chap59.html#leanpub-auto-named-arguments'><span class="section-number">52. </span>Named Arguments</a>
      </li>
      <li>
        <a href='chap60.html#leanpub-auto-variable-arguments-varargs'><span class="section-number">53. </span>Variable Arguments (Varargs)</a>
      </li>
      <li>
        <a href='chap61.html#leanpub-auto-return-value'><span class="section-number">54. </span>Return value</a>
      </li>
      <li>
        <a href='chap62.html#leanpub-auto-throwing-an-exception'><span class="section-number">55. </span>Throwing an exception</a>
      </li>
      <li>
        <a href='chap63.html#leanpub-auto-documenting-a-method'><span class="section-number">56. </span>Documenting a method</a>
      </li>
      <li>
        <a href='chap64.html#leanpub-auto-techniques'><span class="section-number">57. </span>Techniques</a>
      </li>
      <li>
        <a href='chap65.html#leanpub-auto-colophon'>Colophon</a>
      </li>
    </ul>
  </li>
</ul>

</ol>
</div>
<div id="leanpub-main">
<h2 id="leanpub-auto-blocks"><span class="section-number">35. </span>Blocks</h2>

<table class="information sidebarish">
  <tbody>
    <tr><td class="sidebar-icon">
      <img class="sidebar-image" src="images/leanpub_info-circle.png" alt="information" width="50px" /></td>
    <td>
      <p>These blocks are not as fun as the wooden version but just as important in building programs.</p>

    </td>
  </tr>
  </tbody>
</table><p>This chapter is really just a note about syntax - feel free to move to the next chapter after a quick glance here.</p>

<p>Groovy uses curly brackets <code>{..}</code> to enclose blocks of code. These are primarily used to group a set of statements within elements such as control flow, class, method and closure declarations. Blocks also let you “partition off” parts of code so that items such as variables aren’t visible to other parts of your code - referred to as “scope”.</p>

<p>Groovy doesn’t allow the use of anonymous code block such as the one below:</p>

<div class="code-block">
  <p class="codeblock-title">A sample block</p>

  <hr /><div class="highlight"><pre><code class="p">{</code>
    <code class="n">def</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code>
    <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
<code class="p">}</code>
</pre></div>

  <hr /></div>

<p>You need to label the block provided above if you want to use it in Groovy code:</p>

<div class="code-block">
  <p class="codeblock-title">A labelled block</p>

  <hr /><div class="highlight"><pre><code class="nl">Block1:</code><code class="p">{</code>
    <code class="n">def</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code>
    <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
<code class="p">}</code>
</pre></div>

  <hr /></div>

<p>This limitation is primarily due to the closure syntax - labelling the block ensures it isn’t confused with a closure.</p>

<p>Blocks appearing within blocks are called “nested blocks”:</p>

<div class="code-block">
  <p class="codeblock-title">A nested block</p>

  <hr /><div class="highlight"><pre><code class="nl">Block1:</code><code class="p">{</code>
    <code class="n">def</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code>
    <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
    <code class="nl">NestedBlock:</code> <code class="p">{</code>
        <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
    <code class="p">}</code>
<code class="p">}</code>
</pre></div>

  <hr /></div>

<p>If the above code was a Groovy script the block structures really would be redundant “noise” - you’re not likely to see usage such as <code>Block1:{..}</code> very often. You’re more likely to see blocks used with control flow statements (such as <code>if</code>):</p>

<div class="code-block">
<div class="highlight"><pre><code class="k">if</code> <code class="p">(</code><code class="nb">true</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">//some code</code>
<code class="p">}</code>
</pre></div>

</div>

<p>… in class declarations:</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">class</code> <code class="n">Person</code> <code class="p">{</code>

<code class="p">}</code>
</pre></div>

</div>

<p>… in method declarations:</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">def</code> <code class="nf">doStuff</code><code class="p">()</code> <code class="p">{</code>

<code class="p">}</code>
</pre></div>

</div>

<p>… in closure declarations</p>

<div class="code-block">
<div class="highlight"><pre><code class="p">{</code><code class="n">name</code> <code class="o">-&gt;</code> 
    <code class="n">println</code> <code class="s">"Hello, $name"</code>
<code class="p">}</code>
</pre></div>

</div>

<h3 id="leanpub-auto-variable-scope">Variable Scope</h3>

<p>Variable Scope refers to the visibility of a variable from other blocks. A variable declared at the top level is visible to blocks nested within it. The reverse, however, is not true. This lets us declare variables within a block that is specific to that block (and any nested blocks) but doesn’t interfere with the rest of the program.</p>

<p>In the example below, the code within <code>Block1</code> can “see” the <code>count</code> variable so both asserts work:</p>

<div class="code-block">
  <p class="codeblock-title">A sample block</p>

  <hr /><div class="highlight"><pre><code class="n">def</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code>

<code class="nl">Block1:</code> <code class="p">{</code>
    <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
<code class="p">}</code>

<code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
</pre></div>

  <hr /></div>

<p>The second <code>assert</code> will fail as <code>count</code> is not in scope in the main body of the script:</p>

<div class="code-block">
<div class="highlight"><pre><code class="nl">Block1:</code> <code class="p">{</code>
    <code class="n">def</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code>
    <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
<code class="p">}</code>

<code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
</pre></div>

</div>

<p>In the next example, <code>count</code> is visible to the nested bock (<code>Block2</code>):</p>

<div class="code-block">
<div class="highlight"><pre><code class="nl">Block1:</code><code class="p">{</code>
    <code class="n">def</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code>
    
    <code class="nl">Block2:</code><code class="p">{</code>
        <code class="n">assert</code> <code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
    <code class="p">}</code>
<code class="p">}</code>
</pre></div>

</div>

<p>What all of this means is that you need to keep an eye on where the variable can be “seen”. In the example below, the <code>volume</code> variable is visible (within scope) of the <code>if</code> block but the <code>dbLevel</code> variable is local to the <code>if</code> block.</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">def</code> <code class="n">volume</code> <code class="o">=</code> <code class="mi">11</code>

<code class="k">if</code> <code class="p">(</code><code class="n">volume</code> <code class="o">&gt;</code> <code class="mi">10</code><code class="p">)</code> <code class="p">{</code>
    <code class="n">def</code> <code class="n">dbLevel</code> <code class="o">=</code> <code class="err">'</code><code class="n">extreme</code><code class="err">'</code>
    <code class="n">println</code> <code class="s">"A volume of $volume is $dbLevel"</code>
    <code class="c1">//more code</code>
<code class="p">}</code>
</pre></div>

</div>

<p>I repeatedly make a mistake in which I declare a variable within a <code>try</code> block but I need to use the variable later on. The code below is an example of my mistake - <code>println myObj</code> will never work as <code>myObj</code> is not visible at that level.</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">try</code> <code class="p">{</code>
    <code class="n">def</code> <code class="n">myObj</code> <code class="o">=</code> <code class="n">new</code> <code class="n">Object</code><code class="p">()</code>
<code class="p">}</code> <code class="n">catch</code> <code class="p">(</code><code class="n">any</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">//Do something to handle the exception</code>
<code class="p">}</code>

<code class="n">println</code> <code class="n">myObj</code>
</pre></div>

</div>

<p>I’ve put the <code>def myObj = new Object()</code> into the <code>try</code> block as the instantiation may cause an exception. What I needed to do was separate the variable definition (<code>def</code>) from the creation of a new instance (instantiation):</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">def</code> <code class="n">myObj</code>

<code class="n">try</code> <code class="p">{</code>
    <code class="n">myObj</code> <code class="o">=</code> <code class="n">new</code> <code class="n">Object</code><code class="p">()</code>
<code class="p">}</code> <code class="n">catch</code> <code class="p">(</code><code class="n">any</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">//Do something to handle the exception</code>
<code class="p">}</code>

<code class="n">println</code> <code class="n">myObj</code>
</pre></div>

</div>
</div>
</body>
</html>
